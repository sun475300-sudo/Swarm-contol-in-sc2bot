# 대군주 스카우팅 문제 해결 보고서

## 📋 문제 개요
인구수가 막혔는데도 계속 대군주를 적진에 보내는 문제가 발생했습니다. 이로 인해:
1. 대군주가 적의 공격에 죽어 인구수 공급이 더욱 부족해짐
2. 인구수 블록 상황에서 대군주를 생산해야 하는데, 대군주가 죽어서 더 심각해짐
3. 인구수 부족으로 병력 생산이 완전히 멈춤

---

## 🔍 문제 원인 분석

### 1. **대군주 스카우팅 로직의 안전 체크 부재**

**위치**: 
- `scouting_system.py` - `_manage_overlord_scout()` 함수
- `wicked_zerg_bot_pro.py` - `_fast_scouting_20_seconds()` 함수

**원인**:
- 대군주를 적진에 보내기 전에 인구수 상태를 확인하지 않음
- 대군주 개수가 충분한지 확인하지 않음
- 인구수가 막혀도 무조건 첫 번째 대군주를 적진에 보냄

**문제 시나리오**:
```
1. 인구수 블록 발생 (supply_left < 4)
2. 대군주 생산 필요
3. 하지만 스카우팅 로직이 첫 번째 대군주를 적진에 보냄
4. 대군주가 적의 공격에 죽음
5. 인구수 공급이 더욱 부족해짐
6. 대군주 생산이 더 어려워짐
7. 병력 생산 완전 중단
```

---

## ✅ 해결 방법

### 1. **안전 체크 조건 추가**

대군주를 적진에 보내기 전에 다음 조건들을 확인하도록 수정했습니다:

```python
# 안전 체크 조건
supply_blocked = b.supply_left < 4  # 인구수 막힘
low_supply_buffer = b.supply_left < 8 and total_overlords < 4  # 인구수 버퍼 부족
too_few_overlords = total_overlords < 3  # 대군주 개수 부족

should_not_scout = supply_blocked or low_supply_buffer or too_few_overlords
```

**조건 설명**:
- **인구수 막힘 (supply_left < 4)**: 인구수가 4 미만이면 대군주를 적진에 보내지 않음
- **인구수 버퍼 부족**: 인구수가 8 미만이고 대군주가 4개 미만이면 보내지 않음
- **대군주 개수 부족**: 전체 대군주(생산 중 포함)가 3개 미만이면 보내지 않음

### 2. **안전한 위치로 이동**

위험한 상황에서는 대군주를 적진에 보내는 대신 안전한 위치로 이동시킵니다:

```python
if should_not_scout:
    # Keep overlord safe near our base instead
    if b.townhalls.exists:
        townhalls = [th for th in b.townhalls]
        if townhalls:
            safe_pos = townhalls[0].position.towards(b.game_info.map_center, 15)
            scout_overlord.move(safe_pos)
            print(f"[SCOUT] ⚠️ Overlord scouting delayed - Supply blocked")
```

---

## 📝 수정된 파일

### 1. `scouting_system.py`
- `_manage_overlord_scout()` 함수에 안전 체크 추가
- 인구수 블록 상황에서 대군주를 안전한 위치로 이동

### 2. `wicked_zerg_bot_pro.py`
- `_fast_scouting_20_seconds()` 함수에 안전 체크 추가
- 대군주 개수가 충분할 때만 적진에 보내도록 수정

---

## 🎯 예상 효과

### 수정 전:
```
인구수 막힘 → 대군주를 적진에 보냄 → 대군주 죽음 → 인구수 더 부족 → 병력 생산 중단
```

### 수정 후:
```
인구수 막힘 → 대군주를 안전한 위치에 유지 → 대군주 생산 → 인구수 해결 → 병력 생산 재개
```

### 구체적인 개선 사항:

1. **인구수 블록 시 대군주 보호**
   - 인구수가 막혔을 때 대군주를 적진에 보내지 않음
   - 대군주가 안전하게 유지되어 인구수 공급 유지

2. **대군주 개수 관리**
   - 최소 3개 이상의 대군주가 있을 때만 적진에 보냄
   - 인구수 버퍼를 유지하여 병력 생산 지속

3. **안전한 스카우팅**
   - 위험한 상황에서는 대군주를 우리 기지 근처에 배치
   - 인구수 문제가 해결되면 다시 스카우팅 재개

---

## 📊 로그 메시지

수정 후 다음과 같은 로그 메시지가 나타납니다:

```
[SCOUT] [120s] ⚠️ Overlord scouting delayed - Supply blocked (supply: 2/30, overlords: 2)
[SCOUT] [180s] ⚠️ 대군주 스카우팅 지연 - 인구수 막힘 (supply: 3/38, 대군주: 3)
```

이 메시지들은 대군주가 안전을 위해 스카우팅을 지연하고 있음을 알려줍니다.

---

## 🔄 다음 단계

1. **게임 테스트**: 수정된 로직이 정상 작동하는지 확인
2. **로그 모니터링**: 대군주 스카우팅 지연 메시지가 적절히 나타나는지 확인
3. **인구수 블록 개선**: 대군주 생산 로직도 함께 개선하여 인구수 블록 자체를 줄임

---

## 💡 추가 권장 사항

1. **대군주 생산 우선순위 강화**
   - 인구수 블록 상황에서 대군주 생산을 최우선으로 처리
   - 라바가 부족할 때도 대군주 생산을 위해 라바를 예약

2. **대군주 위치 관리**
   - 대군주를 안전한 고지에 배치하여 시야 확보
   - 적의 공격을 받기 쉬운 위치에 배치하지 않음

3. **스카우팅 대체 수단**
   - 대군주가 부족할 때는 저글링이나 다른 유닛으로 스카우팅
   - 대군주는 인구수 공급에 집중

---

**작성일**: 2026-01-15  
**수정 파일**: 
- `wicked_zerg_challenger/scouting_system.py`
- `wicked_zerg_challenger/wicked_zerg_bot_pro.py`
