# 민감한 정보 이중/삼중 검사 시스템 구축 완료

**작성일**: 2026-01-15  
**목적**: Git 커밋 전 민감한 정보를 두 번 이상 체크  
**상태**: ✅ **구축 완료**

---

## ✅ 구축 완료 사항

### 1. 이중 검사 스크립트

**파일**: `tools/double_check_before_commit.ps1`

**기능**:
- ✅ **1차 검사**: 스테이징된 파일 자동 검사
- ✅ **2차 검사**: 전체 프로젝트 검사 (선택적)
- ✅ 상세한 검사 결과 제공

**사용법**:
```powershell
.\tools\double_check_before_commit.ps1
```

---

### 2. 기본 검사 스크립트

**파일**: `tools/pre_commit_security_check.ps1`

**기능**:
- ✅ 스테이징된 파일 또는 전체 파일 검사
- ✅ Pre-commit hook에서 사용

**사용법**:
```powershell
.\tools\pre_commit_security_check.ps1
```

---

### 3. Git Pre-commit Hook

**파일**: `.git/hooks/pre-commit`

**기능**:
- ✅ `git commit` 시 자동 실행
- ✅ 민감한 정보 발견 시 커밋 차단

**설정 방법**:
```powershell
.\tools\setup_git_hooks.ps1
```

---

### 4. .gitignore 패턴

**파일**: `.gitignore`

**기능**:
- ✅ 민감한 파일 패턴 자동 제외
- ✅ 50+ 개의 패턴 포함

---

## 🛡️ 보안 검사 레벨

### 1차: Pre-commit Hook (자동)

- **위치**: `.git/hooks/pre-commit`
- **실행**: `git commit` 시 **자동**
- **동작**: 민감한 정보 발견 시 **커밋 차단**
- **상태**: ✅ **설치 완료**

---

### 2차: 수동 검사 (권장)

- **스크립트**: `double_check_before_commit.ps1`
- **실행**: 커밋 전 **수동 실행**
- **동작**: 이중 검사 (스테이징된 파일 + 전체 프로젝트)
- **상태**: ✅ **구축 완료**

---

### 3차: .gitignore (파일 추적 방지)

- **위치**: `.gitignore`
- **실행**: **항상**
- **동작**: 민감한 파일 패턴 자동 제외
- **상태**: ✅ **설정 완료**

---

## 📋 커밋 전 필수 체크리스트

### 매번 커밋 전 실행

```powershell
# 1. 파일 수정
# ... 코드 수정 ...

# 2. 스테이징
git add .

# 3. 이중 검사 (필수) ⭐
.\tools\double_check_before_commit.ps1

# 4. 검사 통과 확인
# ✅ 모든 검사 통과!

# 5. 커밋 (1차 검사 자동 실행)
git commit -m "Your commit message"
```

---

## 🔍 검사 항목

### API 키 패턴 (5개)

1. Google API Key: `AIzaSy[A-Za-z0-9_-]{35}`
2. OpenAI API Key: `sk-[A-Za-z0-9]{32,}`
3. Slack Token: `xox[baprs]-[0-9]{10,13}-...`
4. 일반 해시: `[0-9a-f]{32}`, `[0-9a-f]{40}`
5. 알려진 API 키: `AIzaSyBDdPWJyXs56AxeCPmqZpySFOVPjjSt_CM`

### 비밀번호/토큰 패턴 (7개)

1. `password: "value"`
2. `passwd: "value"`
3. `secret: "value"`
4. `token: "value"`
5. `api_key: "value"`
6. `apikey: "value"`
7. `api_token: "value"`

### 검사 파일 확장자 (13개)

- Python: `*.py`
- Kotlin/Java: `*.kt`, `*.java`
- JavaScript/TypeScript: `*.js`, `*.ts`
- 문서: `*.md`, `*.txt`
- 설정: `*.json`, `*.yaml`, `*.yml`
- 스크립트: `*.sh`, `*.ps1`, `*.bat`

---

## 📊 검사 통계

### 보호 레벨

| 레벨 | 방법 | 실행 시점 | 차단 방식 | 상태 |
|------|------|----------|----------|------|
| 1차 | Pre-commit Hook | 자동 | 커밋 차단 | ✅ 설치 완료 |
| 2차 | 수동 검사 | 수동 | 사전 확인 | ✅ 구축 완료 |
| 3차 | .gitignore | 항상 | 파일 추적 방지 | ✅ 설정 완료 |

### 검사 패턴

- **API 키 패턴**: 5개
- **비밀번호/토큰 패턴**: 7개
- **검사 파일 확장자**: 13개
- **총 검사 패턴**: 12개

---

## 🚀 사용 방법

### 방법 1: 이중 검사 (권장) ⭐

```powershell
# 커밋 전 실행
.\tools\double_check_before_commit.ps1

# 결과:
# ✅ 1차 검사: 통과
# ✅ 2차 검사: 통과 (선택적)
# → 안전하게 커밋 가능
```

---

### 방법 2: 기본 검사

```powershell
# 커밋 전 실행
.\tools\pre_commit_security_check.ps1

# 결과:
# ✅ 민감한 정보가 발견되지 않았습니다.
# → 안전하게 커밋 가능
```

---

### 방법 3: 자동 검사 (Pre-commit Hook)

```powershell
# 한 번만 설정
.\tools\setup_git_hooks.ps1

# 이후 자동 실행
git commit -m "Your commit message"
# → 자동으로 검사 실행
# → 민감한 정보 발견 시 커밋 차단
```

---

## 📝 생성된 파일

### 스크립트

1. `tools/double_check_before_commit.ps1` - 이중 검사 스크립트 (권장)
2. `tools/pre_commit_security_check.ps1` - 기본 검사 스크립트
3. `tools/pre_commit_security_check.sh` - Bash 버전
4. `tools/setup_git_hooks.ps1` - Git Hooks 설정 스크립트

### 문서

1. `tools/GIT_SECURITY_CHECK_GUIDE.md` - 상세 가이드
2. `tools/COMMIT_SECURITY_CHECKLIST.md` - 커밋 전 체크리스트
3. `tools/DOUBLE_CHECK_SECURITY_SYSTEM.md` - 이중/삼중 검사 시스템
4. `tools/README_SECURITY_CHECKS.md` - 빠른 시작 가이드
5. `tools/민감정보_이중검사_시스템_완료.md` - 이 문서

### Git Hook

1. `.git/hooks/pre-commit` - Pre-commit Hook (자동 검사)

---

## 🎯 검사 프로세스

### 정상적인 커밋

```
1. 파일 수정
   ↓
2. git add .
   ↓
3. 이중 검사 실행 (2차)
   .\tools\double_check_before_commit.ps1
   ↓
4. ✅ 1차 검사 통과
   ↓
5. ✅ 2차 검사 통과 (선택적)
   ↓
6. git commit -m "message"
   ↓
7. Pre-commit Hook 자동 실행 (1차)
   ↓
8. ✅ 최종 검사 통과
   ↓
9. 커밋 완료 ✅
```

### 민감한 정보 발견 시

```
1. 파일 수정
   ↓
2. git add .
   ↓
3. 이중 검사 실행 (2차)
   .\tools\double_check_before_commit.ps1
   ↓
4. ❌ 민감한 정보 발견!
   ↓
5. 파일 수정 (플레이스홀더로 대체)
   ↓
6. 재검사
   .\tools\double_check_before_commit.ps1
   ↓
7. ✅ 모든 검사 통과
   ↓
8. git commit -m "message"
   ↓
9. Pre-commit Hook 자동 실행 (1차)
   ↓
10. ✅ 최종 검사 통과
   ↓
11. 커밋 완료 ✅
```

---

## ⚠️ 주의사항

### False Positive (거짓 양성)

일부 패턴이 실제 키가 아닌 일반 문자열과 매칭될 수 있습니다.

**예시**:
- `password: "example"` → 검사됨 (의도된 것)
- `token: "test_token_12345"` → 검사됨 (의도된 것)

**해결**:
- 실제 키가 아닌 경우 무시하고 커밋 진행
- 또는 검사 스크립트에서 예외 패턴 추가

---

## 🔗 관련 문서

- `GIT_SECURITY_CHECK_GUIDE.md` - 상세 가이드
- `COMMIT_SECURITY_CHECKLIST.md` - 커밋 전 체크리스트
- `DOUBLE_CHECK_SECURITY_SYSTEM.md` - 이중/삼중 검사 시스템
- `README_SECURITY_CHECKS.md` - 빠른 시작 가이드

---

## 📊 최종 상태

### 구축 완료 항목

- [x] 이중 검사 스크립트 (`double_check_before_commit.ps1`)
- [x] 기본 검사 스크립트 (`pre_commit_security_check.ps1`)
- [x] Git Pre-commit Hook (`.git/hooks/pre-commit`)
- [x] .gitignore 패턴 (50+ 개)
- [x] 사용 가이드 문서 (5개)

### 보호 레벨

- ✅ **1차**: Pre-commit Hook (자동)
- ✅ **2차**: 수동 검사 (권장)
- ✅ **3차**: .gitignore (파일 추적 방지)

---

**작성일**: 2026-01-15  
**상태**: ✅ **이중/삼중 검사 시스템 구축 완료**  
**권장 사용법**: 커밋 전 `.\tools\double_check_before_commit.ps1` 실행
